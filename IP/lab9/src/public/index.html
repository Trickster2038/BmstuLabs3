<!DOCTYPE html>
<html> 
<head>
	<meta http-equiv="Content-Type" content="text/html;
	charset=utf-8" />
	<title>AJAX lab9</title>
	<script>
		form_url= location.protocol + "//" + location.host +
		"/automorphs/view.json"
		function send_query(){
			var frm = document.forms.input_form;
			var param_str = "";
			//var radios = frm.op;
			// for (var i = 0; i < radios.length; i++) {
			// 	if (radios[i].checked) {
			// 		param_str = "?" +
			// 		"v1=" + frm.v1.value +
			// 		"&v2=" + frm.v2.value +
			// 		"&op=" +
			// 		encodeURIComponent(frm.op[i].value)
			// 		break;
			// 	}
			// }
			param_str = "?" + "search_range=" + frm.search_range.value
			if (param_str == "") return false;
			var my_JSON_object = {};
			var http_request = new XMLHttpRequest();
			http_request.open("GET", form_url + param_str, true);
			http_request.onreadystatechange = function () {
				var done = 4, ok = 200;
				if (http_request.readyState == done &&
					http_request.status == ok) {
					my_JSON_object =
				JSON.parse(http_request.responseText);
				show_result(my_JSON_object);
			}
		};
		http_request.send(null);
		return false;
	}
	function show_result(data){
		var result = document.getElementById("result");
		if(data.type == "Array"){
			s = "<table><tr><td>sequence</td><td>size</td></tr>"

			let max = [];
			data.value.forEach(function(item, i, arr) {
				if(item.length > max.length){
					max = item
				}
				s+= "<tr><td>" + item + "</td><td>" + item.length + "</td></tr>" ;
			});

			s += "<tr><td>longest part</td><td>size</td></tr>"
			s += "<tr><td>" + max + "</td><td>" + max.length + "</td></tr>"
		} else {
			s = data.value
		}

			result.innerHTML = "<hr/>Result is: " + s +
			"<p>"+"</p>";

	}
</script> 
</head>
<body>
	<h1>AJAX square sequences search</h1>
	<form name="input_form" method="get">
		<label for="Sequence:">Input numbers:</label>
		<input id="search_range" name="search_range" type="text" /> <br/>
		<br/>
		<input name="commit" type="submit"
		value="Output result" onclick="return send_query();" />
	</form>
	<div id="result"></div>
</body>
</html> 